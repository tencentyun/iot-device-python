* [事件上报以及多事件上报](#事件上报以及多事件上报)
  * [发布事件上报的 Topic ](#发布事件上报的-Topic)
  * [发布多事件上报的 Topic ](#发布多事件上报的-Topic)

# 事件上报以及多事件上报

本文主要描述设备端如何发布事件上报以及多事件上报的 Topic 。

## 发布事件上报的 Topic 

运行 [MqttSample.py](../sample/MqttSample.py) 的main函数，设备成功上线后，成功订阅过Topic后，调用eventSinglePost()，发布事件类型的 Topic:
`$thing/up/event/{ProductID}/{DeviceName}`

示例代码如下：

```
timestamp = int(round(time.time() * 1000))
event = {
    "events": [
        {
            "eventId": "status_report",
            "type": "info",
            "timestamp": timestamp,
            "params": {
                "status":0,
                "message":""
            }
		 }
    ]
}
te.template_event_post(event)
```

观察Logcat日志。

```
23/02/2021 20:43:58,024 [main] INFO  TXMqttConnection publish 492  - Starting publish topic: $thing/up/event/LWVUL5SZ2L/light1 Message: {"eventId":"status_report","method":"event_post","clientToken":"LWVUL5SZ2Llight13","type":"info","params":{"message":"","status":0},"timestamp":1614084238023}

```
以上是设备成功发布单个事件上报Topic的日志。如果已订阅 Topic，设备会接收到如上日志中的event_reply消息。在控制台创建的对应设备中，可查看到对应的设备事件，若传入的type为info时，代表信息类型的事件。控制台中查看设备事件，请参考 [设备调试](https://cloud.tencent.com/document/product/1081/34741) 章节。

## 发布多事件上报的 Topic 

运行 [MqttSample.py](../sample/MqttSample.py) 的main函数，设备成功上线后，成功订阅过Topic后，调用eventsPost()，发布事件类型的 Topic:
`$thing/up/event/{ProductID}/{DeviceName}`

示例代码如下：

```

event_list = te.template_events_list

# deal events and add your real value
status = 1
message = "message"
voltage = 20.0
name = "memory"
error_code = 0
timestamp = int(round(time.time() * 1000))

events = {
    "events": [
        {
            "eventId": event_list[0].event_name,
            "type": event_list[0].type,
            "timestamp": timestamp,
            "params": {
                event_list[0].events_prop[0].key:status,
                event_list[0].events_prop[1].key:message
            }
		 },
        {
            "eventId": event_list[1].event_name,
            "type": event_list[1].type,
            "timestamp": timestamp,
            "params": {
                event_list[1].events_prop[0].key:voltage
            }
        },
        {
            "eventId": event_list[2].event_name,
            "type": event_list[2].type,
            "timestamp": timestamp,
            "params": {
                event_list[2].events_prop[0].key:name,
                event_list[2].events_prop[1].key:error_code
            }
        }
    ]
}
te.template_event_post(events)
```

观察输出日志。

```
23/02/2021 21:08:28,081 [main] INFO  TXMqttConnection publish 492  - Starting publish topic: $thing/up/event/LWVUL5SZ2L/light1 Message: {"method":"events_post","clientToken":"LWVUL5SZ2Llight13","events":[{"eventId":"status_report","type":"info","params":{"message":"","status":0},"timestamp":1614085664165},{"eventId":"low_voltage","type":"alert","params":{"voltage":1},"timestamp":1614085664165},{"eventId":"hardware_fault","type":"fault","params":{"name":"","error_code":1},"timestamp":1614085664165}]}
23/02/2021 21:08:28,084 [MQTT Call: LWVUL5SZ2Llight1] DEBUG MqttSample onPublishCompleted 319  - onPublishCompleted, status[OK], topics[[$thing/up/event/LWVUL5SZ2L/light1]],  userContext[], errMsg[publish success]
23/02/2021 21:08:28,115 [MQTT Call: LWVUL5SZ2Llight1] DEBUG MqttSample onMessageReceived 351  - receive message, topic[$thing/down/event/LWVUL5SZ2L/light1], message[{"method":"events_reply","clientToken":"LWVUL5SZ2Llight13","code":0,"status":"","data":{}}]
```

以上是设备成功发布多个事件上报Topic的日志。如果已订阅 Topic，设备会接收到如上日志中的events_reply消息。在控制台创建的对应设备中，可查看到对应的设备事件，若传入的type为info时，代表信息类型的事件；若传入的type为alert时，代表告警类型的事件；若传入的type为fault时，代表故障类型的事件。控制台中查看设备事件，请参考 [设备调试](https://cloud.tencent.com/document/product/1081/34741) 章节。
